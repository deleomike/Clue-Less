<!DOCTYPE html>
<html>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<body>
    <h1>Welcome to Clue-Less!</h1>
    
    <div>
        <h2>Please create a new user:</h2>
        <form id="registerForm", onsubmit="return false;">
            <label for="email">Email:</label>
            <input type="text" id="email" name="email"><br>
            <label for="password">Password:</label>
            <input type="text" id="password" name="password"><br>
            <button type="submit">Create</button>
        </form>

        
        <br>

        <h2>Or login:</h2>
        <form id="loginForm", onsubmit="return false;">
            <label for="login-email">Email:</label>
            <input type="text" id="login-email" name="login-email"><br>
            <label for="login-password">Password:</label>
            <input type="text" id="login-password" name="login-password"><br>
            <button type="submit">Login</button>
        </form>

    </div>

    <script>

        function loginUser(username, password){
            console.log("loginUser()");
            const url = "/api/auth/jwt/login";

            const params = new URLSearchParams();
            params.append('username', username);
            params.append('password', password);
            params.append('grant_type', '');
            params.append('client_secret', '');
            params.append('scope', '');

            axios.post(url, params)
              .then((response) => {
                console.log(response.data);
                console.log("Logged in, setting cookie")
                document.cookie = "token=" + response.data["access_token"];
              })
              .then((error) => console.log(error));
        }

        async function createUser(){
            console.log("postCreateUser()");
            const url = "/api/auth/register";

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            axios.post(url, {
                email: email,
                password: password,
                is_active: true,
                is_superuser: false,
                is_verified: false
              })
              .then((response) => {
                console.log(response.data);
                console.log("Hello World")

                loginUser(email, password)
              })
              .then((error) => console.log(error));
        }

        async function postLogin(){
            console.log("postLogin()")
            const url = '/api/auth/jwt/login';

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            loginUser(email, password)
        }

        document.getElementById("registerForm").addEventListener("submit", createUser);
        document.getElementById("loginForm").addEventListener("submit", postLogin);

        console.log(document.cookie)

    </script>



</body>
</html>


