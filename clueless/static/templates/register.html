{% include "base_layout.html" %}
    <h1>Register</h1>

    <form id="registerForm", onsubmit="return false;">
        <label for="email">Email:</label>
        <input type="text" id="email" name="email"><br>
        <label for="password">Password:</label>
        <input type="text" id="password" name="password"><br>
        <button type="submit">Create</button>
    </form>

    <script>
        function loginUser(username, password){
            console.log("loginUser()");
            const url = "/api/auth/jwt/login";

            const params = new URLSearchParams();
            params.append('username', username);
            params.append('password', password);
            params.append('grant_type', '');
            params.append('client_secret', '');
            params.append('scope', '');

            axios.post(url, params)
              .then((response) => {
                console.log(response.data);
                console.log("Logged in, setting cookie")
                document.cookie = "token=" + response.data["access_token"];
              })
              .then((error) => console.log(error));
        }

        async function createUser(){
            console.log("postCreateUser()");
            const url = "/api/auth/register";

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            axios.post(url, {
                email: email,
                password: password,
                is_active: true,
                is_superuser: false,
                is_verified: false
              })
              .then((response) => {
                console.log(response.data);
                console.log("Hello World")

                loginUser(email, password)
              })
              .then((error) => console.log(error));
        }

    </script>
{% block body %}{% endblock %}