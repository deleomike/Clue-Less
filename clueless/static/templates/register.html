{% include "base_layout.html" %}
    <h1>Register</h1>

    <form id="registerForm", onsubmit="createUser(); return false;">
        <label for="email">Email:</label>
        <input type="text" id="email" name="email"><br>
        <label for="password">Password:</label>
        <input type="text" id="password" name="password"><br>
        <button type="submit">Create</button>
    </form>
<!-- 
    <script type="module" src="{{ url_for('static', path='auth.js') }}">
        import { loginUser } from "{{ url_for('static', path='auth.js') }}";
        window.loginUser = loginUser;
    </script> -->
    <script>
        function loginUser(username, password){
            console.log("loginUser()");
            const url = "/api/auth/jwt/login";
            
            const params = new URLSearchParams();
            params.append('username', username);
            params.append('password', password);
            params.append('grant_type', '');
            params.append('client_secret', '');
            params.append('scope', '');
            
            axios.post(url, params)
                .then((response) => {
                console.log(response.data);
                const token = response.data["access_token"]
                console.log(`Logged in, setting cookie ${token}`)
                document.cookie = `token=${token}`;
            
                })
                .catch( function(error) {
                console.log(error)
                });
            }


        async function createUser(){
            console.log("postCreateUser()");
            const url = "/api/auth/register";

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            axios.post(url, {
                email: email,
                password: password,
                is_active: true,
                is_superuser: false,
                is_verified: true
              })
              .then((response) => {
                console.log(response.data);
                console.log("Hello World")

                loginUser(email, password)

                window.location.href = "/";
              })
              .then((error) => console.log(error));
        }

        //document.getElementById("registerForm").addEventListener("submit", createUser);

    </script>
{% block body %}{% endblock %}